{% extends 'baseFront.html.twig' %}
{% block title %}Liste des produits{% endblock %}

{% block nav %}
    {{ parent() }}
{% endblock %}

{% block body %}
{% for label, messages in app.flashes %}
    <div class="alert alert-{{ label }} mt-2 fade show" role="alert" 
         style="border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
        {% for message in messages %}
            {{ message }}
        {% endfor %}
    </div>
{% endfor %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
           <form id="search-form" method="GET" action="{{ path('search_products') }}" class="d-flex gap-2 mb-4">
    <input type="text" id="search-input" name="q" class="form-control" placeholder="Rechercher un produit..." autocomplete="off"/>
    <button type="submit" id="search-btn" class="btn btn-primary"><i class="fas fa-search"></i></button>
</form>
<div id="search-results" class="list-group" style="display: none;"></div>

<div class="mt-3">
    <a href="{{ path('listprod') }}" class="btn btn-secondary">                    <i class="fas fa-arrow-left"></i>
</a>
</div>
        </div>
    </div>
</div>
<div class="container mt-4">
    <div class="row g-4">
        {% for product in pagination %}
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                <div class="card product-card h-100 border-0" 
                     style="border-radius: 15px; transition: transform 0.2s, box-shadow 0.2s;">
                    <div class="position-relative">
                        <img src="{{ asset('uploads/produits/' ~ product.image) }}" 
                             class="card-img-top" 
                             alt="{{ product.nom }}" 
                             style="height: 160px; object-fit: cover; border-radius: 15px 15px 0 0;">
                        <div class="position-absolute top-0 end-0 m-2">
                            <span class="badge bg-primary rounded-pill">
                                Stock: {{ product.quantite }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="card-body p-3">
                        <h5 class="card-title mb-2 text-truncate fw-bold" 
                            style="font-size: 0.9rem; color:rgb(44, 80, 58);">
                            {{ product.nom }}
                        </h5>
                        <p class="fw-bold mb-2" 
                           style="font-size: 1.1rem; color: #e74c3c;">
                            {{ product.prix }} €
                        </p>
                        
                        <form action="{{ path('add_to_cart', { id: product.id }) }}" 
                              method="post" 
                              class="mt-2">
                            <div class="d-flex gap-2 justify-content-between align-items-center">
                                <div class="quantity-input" 
                                     style="flex: 0 0 40%;">
                                    <input type="number" 
                                           name="quantity" 
                                           class="form-control form-control-sm text-center" 
                                           value="1" 
                                           min="1"
                                           max="{{ product.quantite }}"
                                           style="border-radius: 8px; border: 2px solid #eee;">
                                </div>
                                <button type="submit" 
                                        class="btn btn-primary flex-grow-1" 
                                        style="border-radius: 8px; font-size: 0.85rem;">
                                    <i class="fas fa-cart-plus me-1"></i> 
                                </button>
                                <a href="{{ path('produit_viewuser', { id: product.id }) }}" class="btn btn-view">
                            <i class="fas fa-eye"></i> 
                        </a>
                            </div>
                        </form>
          

                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<style>
    #search-results {
    max-height: 300px; /* Limite la hauteur de la liste des suggestions */
    overflow-y: auto; /* Ajoute un défilement vertical si la liste dépasse */
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 5px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    z-index: 1000; /* S'assure que la liste s'affiche au-dessus des autres éléments */
}

#search-results .list-group-item {
    border: none;
    padding: 10px;
    font-size: 14px;
    color: #333;
    transition: background-color 0.3s ease, color 0.3s ease; /* Transition pour le survol */
}

#search-results .list-group-item:hover {
    background-color: #f0f0f0; /* Effet de survol */
    color:rgb(84, 199, 107); /* Changer la couleur du texte au survol */
    cursor: pointer;
}

#search-results .list-group-item:active {
    background-color: #e6e6e6; /* Effet au clic */
}

#search-results .list-group-item:focus {
    outline: none; /* Supprime la bordure de focus */
    box-shadow: 0 0 5px rgba(84, 199, 107, 0.5); /* Ajoute une ombre subtile pour l'effet de focus */
}

#search-results .list-group-item a {
    color: inherit; /* Hérite de la couleur du texte */
    text-decoration: none;
}

#search-results .list-group-item a:hover {
    color: inherit;
    text-decoration: underline; /* Souligne au survol */
}

    .product-card {
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        background: white;
    }
    
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    
    .quantity-input input:focus {
        box-shadow: none;
        border-color: #3498db;
    }
    
    .btn-primary {
        background: linear-gradient(45deg, #218838, #218838);
        border: none;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 3px 8px rgba(52, 152, 219, 0.3);
    }
    
    .alert {
        animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
        from {
            transform: translateY(-20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }
    
    /* Personnalisation du modal panier */
    .modal-overlay {
        background-color: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
    }
    
    .modal-content {
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .cart-item {
        background: #f8f9fa;
        border-radius: 12px;
        padding: 15px;
        margin-bottom: 10px;
        transition: all 0.2s ease;
    }
    
    .cart-item:hover {
        transform: translateX(5px);
        background: #f1f3f5;
    }
    
    .cart-total {
        background: #e9ecef;
        border-radius: 12px;
        padding: 15px;
        margin-top: 20px;
    }
</style>
<div class="pagination">
    {{ knp_pagination_render(pagination) }}
</div>
<script>
   document.getElementById('search-input').addEventListener('input', function() {
    const searchTerm = document.getElementById('search-input').value;
    console.log("Recherche en cours :", searchTerm); // Ajout de ce log pour vérifier la valeur du terme

    // Si le terme est vide, cacher les résultats
    if (searchTerm.length < 2) {
        document.getElementById('search-results').style.display = 'none';
        return;
    }

    // Requête AJAX pour récupérer les suggestions de produits
    fetch(`/rechercher/ajax?q=${searchTerm}`)
        .then(response => response.json())
        .then(data => {
            console.log("Réponse reçue :", data); // Ajouter ce log pour vérifier la réponse du serveur
            const resultsContainer = document.getElementById('search-results');
            resultsContainer.innerHTML = ''; // Vider les résultats précédents

            if (data.length > 0) {
                resultsContainer.style.display = 'block';
                data.forEach(product => {
                    const productElement = document.createElement('a');
                    productElement.href = `/produit/${product.id}`; // Lien vers la page du produit
                    productElement.classList.add('list-group-item', 'list-group-item-action');
                    productElement.innerText = product.nom;

                    // Ajouter un événement de clic pour injecter le nom du produit dans le champ de recherche
                    productElement.addEventListener('click', function(event) {
                        event.preventDefault();  // Empêcher la redirection immédiate
                        document.getElementById('search-input').value = product.nom;  // Injecte le nom dans le champ
                    });

                    resultsContainer.appendChild(productElement);
                });
            } else {
                resultsContainer.style.display = 'none'; // Aucun résultat
            }
        })
        .catch(error => console.error('Erreur:', error));
});

</script>
{% endblock %}
